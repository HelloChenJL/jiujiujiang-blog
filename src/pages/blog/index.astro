---
import CategoryCards from '@/components/post/CategoryCards.astro';
import HomeSider from '@components/layout/HomeSider.astro';
import PostList from '@components/post/PostList.astro';
import Cover from '@components/ui/cover/Cover.astro';
import TwoColumnLayout from '@components/layout/TwoColumnLayout.astro';
import LayoutFooter from '@components/layout/LayoutFooter';
import { CONTENT_PADDING } from '@constants/layout';
import { Routes } from '@constants/router';
import { blogSeoConfig } from '@/config/blogLayoutConfig';
import Layout from '@layouts/Layout.astro';
import { getNonWeeklyPosts } from '@lib/content';
import { getLayoutFooterData } from '@lib/layout/footer-data';
import type { Page } from 'astro';
import type { BlogPost } from '@/types/blog';

const allPosts = await getNonWeeklyPosts();
const posts = allPosts.slice(0, 10);

const page: Page<BlogPost> = {
  data: posts,
  start: 0,
  end: Math.min(9, posts.length - 1),
  size: 10,
  total: allPosts.length,
  currentPage: 1,
  lastPage: Math.ceil(allPosts.length / 10),
  url: {
    current: Routes.Home,
    prev: undefined,
    next: allPosts.length > 10 ? `${Routes.Posts}/2` : undefined,
    first: Routes.Home,
    last: `${Routes.Posts}/${Math.ceil(allPosts.length / 10)}`,
  },
};

const layoutFooterData = await getLayoutFooterData();
---

<Layout title={blogSeoConfig.title}>
  <TwoColumnLayout>
    <Cover slot="cover" />
    <HomeSider slot="sider" />
    <LayoutFooter slot="footer" {...layoutFooterData} />
    <div
      class={`bg-gradient-start shadow-box tablet:shadow-none flex flex-col gap-4 overflow-hidden  ${CONTENT_PADDING.standard}`}
    >
      <PostList posts={posts} page={page} showPaginator={true} baseUrl={Routes.Posts} isHomePage={true} />
      <CategoryCards />
    </div>
  </TwoColumnLayout>
</Layout>
